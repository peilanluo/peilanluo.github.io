<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.74.2" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>数据结构--红黑树 - 默默的心路</title>
    <meta property="og:title" content="数据结构--红黑树 - 默默的心路">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2021-06-14T19:02:21&#43;08:00">
        
        
    <meta property="article:modified_time" content="2021-06-14T19:02:21&#43;08:00">
        
    <meta name="description" content="数据结构--红黑树">
        
    <meta name="author" content="Qiao">
    <meta property="og:url" content="https://peilanluo.github.io/post/data/red_black_tree/">

    <link rel="stylesheet" href="/css/normalize.css">
    
    <link rel="stylesheet" href="/css/syntax.css">
    
    <link rel="stylesheet" href="/css/style.css">

    </head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://peilanluo.github.io/">
                        默默的心路
                    </a>
                
                <p class="description">每一个恍然的瞬间，都有一段段默默的心路在支撑…</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://peilanluo.github.io/">博客</a>
                    
                    <a  href="https://peilanluo.github.io/archives/" title="存档">
                        存档
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">数据结构--红黑树</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2021年6月14日
                            19:02
                        </date>
                        
                        <div class="post-meta meta-category">
                            ，归类于
                            
                                <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">数据结构</a>
                            
                        </div>
                        <aside id="toc" class="dismissed">
                            <span class="toc-title">目录 <a href="#" class="toc-dismiss"></a></span>
                            <nav id="TableOfContents">
  <ul>
    <li><a href="#红黑树的性质">红黑树的性质</a></li>
    <li><a href="#旋转">旋转</a></li>
    <li><a href="#红黑树的插入操作">红黑树的插入操作</a>
      <ul>
        <li><a href="#插入过程中会发生的性质转变">插入过程中会发生的性质转变</a></li>
        <li><a href="#每次循环开始要保证的变量">每次循环开始要保证的变量</a></li>
        <li><a href="#循环过程中几种情况">循环过程中几种情况</a>
          <ul>
            <li><a href="#情况一z的叔结点y是红色的">情况一：z的叔结点y是红色的</a></li>
            <li><a href="#情况二z的叔结点y是黑色的且z是一个右孩子">情况二：z的叔结点y是黑色的且z是一个右孩子</a></li>
            <li><a href="#情况三z的叔结点y是黑色的且z是一个左孩子">情况三：z的叔结点y是黑色的且z是一个左孩子</a></li>
            <li><a href="#情况四情况五情况六">情况四、情况五、情况六</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#红黑树的删除操作">红黑树的删除操作</a>
      <ul>
        <li><a href="#删除中可能会发生的情况">删除中可能会发生的情况</a></li>
        <li><a href="#修复红黑树性质过程">修复红黑树性质过程</a>
          <ul>
            <li><a href="#情况1x的兄弟结点w是红色的">情况1：x的兄弟结点w是红色的</a></li>
            <li><a href="#情况2x的兄弟结点w是黑色的且w的两个子节点都是黑色的">情况2：x的兄弟结点w是黑色的，且w的两个子节点都是黑色的</a></li>
            <li><a href="#情况3x的兄弟结点w是黑色的w的左孩子是红色的w的右孩子是黑色的">情况3：x的兄弟结点w是黑色的，w的左孩子是红色的，w的右孩子是黑色的</a></li>
            <li><a href="#情况4x的兄弟结点w是黑色的且w的右孩子是红色的">情况4：x的兄弟结点w是黑色的，且w的右孩子是红色的</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
                        </aside><div class="post-content">
                            <p>由于普通二叉搜索树在最坏的情况下会转变成一个线性的链表，其时间复杂度会退化为O(n)，并且如果树的高度很高，他的效率也是无法保证的，所以在普通二叉搜索树的基础上，引入了平衡二叉树的概念，红黑树就是平衡二叉树中的一种，红黑树可以保证在最坏的情况下所有操作的时间复杂度为O(logn)。</p>
<h1 id="红黑树的性质">红黑树的性质</h1>
<p>首先红黑数是一棵二叉搜索树，它在每个结点上增加了一个存储为来表示结点的颜色，可以是<code>RED</code>和<code>BLACK</code>，通过对任何一条从根到叶子的简单路径上各个结点的颜色进行约束，红黑树确保没有一条路径会比其他路径长出2倍，因而是近似于平衡的。</p>
<p>一棵红黑树满足下面几条性质：</p>
<ol>
<li>每个结点或是红色的，或是黑色的。</li>
<li>根节点是黑色的。</li>
<li>每个叶结点（NIL）是黑色的。</li>
<li>如果一个结点是红色的，则它的两个子结点都是黑色的。</li>
<li>对每个结点，从该结点到其所有后代叶结点的简单路径上，均包含相同数目的黑色结点。</li>
</ol>
<p><img src="/imgs/red_black_tree_123414312341341.png" alt="红黑树"></p>
<p>从某个结点x出发（不包含该结点）到达一个叶结点的任意一条简单路径上的黑色结点个数成为该结点的黑高，记为bh(x)。</p>
<p>一棵有n个内部结点的红黑树的高度至多是2lg(n+1)。</p>
<p>以下代码均将使用golang实现，基本数据结构为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">const</span> <span class="p">(</span>
    <span class="c1">// TreeNodeColorRed 红色
</span><span class="c1"></span>    <span class="nx">TreeNodeColorRed</span>   <span class="p">=</span> <span class="s">&#34;red&#34;</span>
    <span class="c1">// TreeNodeColorBlack 黑色
</span><span class="c1"></span>    <span class="nx">TreeNodeColorBlack</span> <span class="p">=</span> <span class="s">&#34;black&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">TreeNode</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Val</span>    <span class="kt">int</span>
    <span class="nx">Color</span>  <span class="kt">string</span>
    <span class="nx">Parent</span> <span class="o">*</span><span class="nx">TreeNode</span>
    <span class="nx">Left</span>   <span class="o">*</span><span class="nx">TreeNode</span>
    <span class="nx">Right</span>  <span class="o">*</span><span class="nx">TreeNode</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">NilNode</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">TreeNode</span><span class="p">{</span>
    <span class="nx">Color</span><span class="p">:</span> <span class="nx">TreeNodeColorBlack</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="旋转">旋转</h1>
<p>当对红黑树进行插入、删除操作时会改变红黑树的性质，所以需要改变树中某些结点的颜色和指针结构。而修改指针结构是通过<code>旋转</code>完成的。</p>
<p><img src="/imgs/red_black_tree_284039240234.png" alt="red_black_tree_284039240234"></p>
<p>以下是旋转的代码实现：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// LeftRotate 左旋
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">LeftRotate</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="nx">x</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">y</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Right</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">Right</span> <span class="p">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Left</span>
    <span class="k">if</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Left</span> <span class="o">!=</span> <span class="nx">NilNode</span> <span class="p">{</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">Left</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">x</span>
    <span class="p">}</span>
    <span class="nx">y</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span>
    <span class="k">if</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span> <span class="o">==</span> <span class="nx">NilNode</span> <span class="p">{</span>
        <span class="c1">//如果x是根节点
</span><span class="c1"></span>        <span class="nx">t</span> <span class="p">=</span> <span class="nx">y</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">==</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span> <span class="p">{</span>
        <span class="c1">// 如果x是左孩子
</span><span class="c1"></span>        <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span> <span class="p">=</span> <span class="nx">y</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// 如果x是右孩子
</span><span class="c1"></span>        <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Right</span> <span class="p">=</span> <span class="nx">y</span>
    <span class="p">}</span>
    <span class="nx">y</span><span class="p">.</span><span class="nx">Left</span> <span class="p">=</span> <span class="nx">x</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">y</span>
<span class="p">}</span>

<span class="c1">// RightRotate 右旋
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">RightRotate</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="nx">x</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">y</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Left</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">Left</span> <span class="p">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Right</span>
    <span class="k">if</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Right</span> <span class="o">!=</span> <span class="nx">NilNode</span> <span class="p">{</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">Right</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">x</span>
    <span class="p">}</span>
    <span class="nx">y</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span>
    <span class="k">if</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span> <span class="o">==</span> <span class="nx">NilNode</span> <span class="p">{</span>
        <span class="c1">// 如果x是根节点
</span><span class="c1"></span>        <span class="nx">t</span> <span class="p">=</span> <span class="nx">y</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">==</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Right</span> <span class="p">{</span>
        <span class="c1">// 如果x是右孩子
</span><span class="c1"></span>        <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Right</span> <span class="p">=</span> <span class="nx">y</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span> <span class="p">=</span> <span class="nx">y</span>
    <span class="p">}</span>
    <span class="nx">y</span><span class="p">.</span><span class="nx">Right</span> <span class="p">=</span> <span class="nx">x</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">y</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="红黑树的插入操作">红黑树的插入操作</h1>
<p>插入的过程为，先将要插入的结点着色为红色，为保证红黑树的基本性质，需要对结点重新着色并旋转。插入操作很好理解，与普通搜索二叉树的插入操作类似，不同之处在于要在插入中对红黑树的性质进行着色和修复，以维护红黑树的性质。以下重点分析执行插入操作后的修复过程：</p>
<p><img src="/imgs/red_black_tree_insert_fix.png" alt="red_black_tree_insert_fix"></p>
<p>如图中的情况：</p>
<ul>
<li>插入结点z，z会被着色为红色，由于z和z的父结点都是红色，所以违反了如果一个结点是红色，其子结点都是黑色的性质，因为z的叔结点y是红色的，可以应用情况1，结点被重新着色，并且指针z沿树上升，得到(b)。</li>
<li>再次发生z和其父结点同时红色的情况，但z的叔结点y是黑色的，因为z是其父结点的右孩子，应用情况2进行左旋，左旋后得到(c)。</li>
<li>z现在是其父结点的左孩子，可以应用情况3，重新着色并执行一次右旋得到(d)，成功。</li>
</ul>
<h2 id="插入过程中会发生的性质转变">插入过程中会发生的性质转变</h2>
<p>具体分析新结点的插入过程中哪些性质可能被破坏：</p>
<ul>
<li>性质1和性质3成立，因为新插入的红结点的两个子节点都是黑色的nil结点。</li>
<li>性质5也会成立，因为z取代了黑色的叶结点并且其自身为有黑色叶结点的红结点。</li>
<li>性质2和性质4有可能被破坏，因为z是红色，所以如果z是根节点则会破坏性质2，如果z的父节点是红色，则会破坏性质4。</li>
</ul>
<h2 id="每次循环开始要保证的变量">每次循环开始要保证的变量</h2>
<p>针对以上情况，在每次循环开始时要保证：</p>
<ul>
<li>结点z是后红结点。</li>
<li>如果z的父结点是根节点，则z的父结点是黑结点。</li>
<li>如果有任何红黑性质被破坏，则至多有一条会被破坏，或是性质2，或是性质4，如果被破坏的是性质2，其原因是z是根节点且为红色。如果性质4被破坏，其原因是z和z的父结点都是红结点。</li>
</ul>
<h2 id="循环过程中几种情况">循环过程中几种情况</h2>
<p>循环过程中会发生六种情况，前三种对应要插入的结点在根节点的左子树中，后三种对应要插入的结点在根节点的右子树中，前三种和后三种完全相反，所以可以理解为实质上是三种情况。</p>
<h3 id="情况一z的叔结点y是红色的">情况一：z的叔结点y是红色的</h3>
<p><img src="/imgs/red_black_tree_situation_1.png" alt="red_black_tree_situation_1"></p>
<p>z和z.p都是红色，z.p.p是黑色的，所以将z.p和y都着色为黑色，将z.p.p着色为红色以保持性质5，然后把z.p.p作为新结点z来重复循环。指针z在树中上移两层。</p>
<h3 id="情况二z的叔结点y是黑色的且z是一个右孩子">情况二：z的叔结点y是黑色的且z是一个右孩子</h3>
<p>结点z是它父结点的右孩子，可以立即使用一个左旋来将情况转变为情况3。</p>
<h3 id="情况三z的叔结点y是黑色的且z是一个左孩子">情况三：z的叔结点y是黑色的且z是一个左孩子</h3>
<p><img src="/imgs/red_black_tree_situation_2.png" alt="red_black_tree_situation_2"></p>
<p>z为其父结点的左孩子，因为z和z.p都是红色的，所以该旋转对结点的黑高和性质5都没有影响。改变某些结点的颜色并做一次右旋，以保持性质5。</p>
<h3 id="情况四情况五情况六">情况四、情况五、情况六</h3>
<p>情况四、情况五、情况六完全与情况一、情况二、情况三对应，直接将情况一、情况二、情况三的left变为right，right变为left则为情况四、情况五、情况六</p>
<p>所以有了下面的代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Insert 插入操作
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Insert</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="nx">z</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">y</span> <span class="o">:=</span> <span class="nx">NilNode</span>
    <span class="nx">x</span> <span class="o">:=</span> <span class="nx">t</span>

    <span class="c1">// 遍历查找插入位置
</span><span class="c1"></span>    <span class="k">for</span> <span class="nx">x</span> <span class="o">!=</span> <span class="nx">NilNode</span> <span class="p">{</span>
        <span class="nx">y</span> <span class="p">=</span> <span class="nx">x</span>
        <span class="k">if</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Val</span> <span class="p">&lt;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Val</span> <span class="p">{</span>
            <span class="nx">x</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Left</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">x</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Right</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">y</span>
    <span class="k">if</span> <span class="nx">y</span> <span class="o">==</span> <span class="nx">NilNode</span> <span class="p">{</span>
        <span class="nx">t</span> <span class="p">=</span> <span class="nx">z</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Val</span> <span class="p">&lt;</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Val</span> <span class="p">{</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">Left</span> <span class="p">=</span> <span class="nx">z</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">Right</span> <span class="p">=</span> <span class="nx">z</span>
    <span class="p">}</span>
    <span class="nx">z</span><span class="p">.</span><span class="nx">Left</span> <span class="p">=</span> <span class="nx">NilNode</span>
    <span class="nx">z</span><span class="p">.</span><span class="nx">Right</span> <span class="p">=</span> <span class="nx">NilNode</span>
    <span class="nx">z</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
    <span class="nf">insertFixup</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">z</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// insertFixup 插入修复
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">insertFixup</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">,</span> <span class="nx">z</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorRed</span> <span class="p">{</span>
        <span class="c1">// z在左子树的三种情况
</span><span class="c1"></span>        <span class="k">if</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span> <span class="o">==</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span> <span class="p">{</span>
            <span class="c1">// 查看其叔结点
</span><span class="c1"></span>            <span class="nx">y</span> <span class="o">:=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Right</span>
            <span class="c1">// 判断叔结点的颜色
</span><span class="c1"></span>            <span class="k">if</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorRed</span> <span class="p">{</span>
                <span class="c1">// 情况1
</span><span class="c1"></span>                <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">y</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
                <span class="nx">z</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">z</span> <span class="o">==</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Right</span> <span class="p">{</span>
                <span class="c1">// 情况2
</span><span class="c1"></span>                <span class="nx">z</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span>
                <span class="nf">LeftRotate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">z</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// 情况3
</span><span class="c1"></span>                <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
                <span class="nf">RightRotate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">y</span> <span class="o">:=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span>
            <span class="k">if</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorRed</span> <span class="p">{</span>
                <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">y</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
                <span class="nx">z</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">z</span> <span class="o">==</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span> <span class="p">{</span>
                <span class="nx">z</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span>
                <span class="nf">RightRotate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">z</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
                <span class="nf">LeftRotate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Parent</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="红黑树的删除操作">红黑树的删除操作</h1>
<p>红黑树删除结点的时间复杂度同为O(lgn)，与插入操作相比，删除操作要更复杂些，但总体上和普通二叉搜索树的差别不大。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Delete 删除
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Delete</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">z</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">y</span> <span class="o">:=</span> <span class="nx">z</span>
    <span class="nx">yOriginColor</span> <span class="o">:=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Color</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">*</span><span class="nx">TreeNode</span>
    <span class="k">if</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Left</span> <span class="o">==</span> <span class="nx">NilNode</span> <span class="p">{</span>
        <span class="c1">// 如果z只有右子树，直接用z的右子树替换z
</span><span class="c1"></span>        <span class="nx">x</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Right</span>
        <span class="nf">transplant</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Right</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Right</span> <span class="o">==</span> <span class="nx">NilNode</span> <span class="p">{</span>
        <span class="c1">// z只有左子树
</span><span class="c1"></span>        <span class="nx">x</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Left</span>
        <span class="nf">transplant</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Left</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">y</span> <span class="p">=</span> <span class="nf">minimum</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">Right</span><span class="p">)</span>
        <span class="nx">yOriginColor</span> <span class="p">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Color</span>
        <span class="nx">x</span> <span class="p">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Right</span>
        <span class="k">if</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Parent</span> <span class="o">==</span> <span class="nx">z</span> <span class="p">{</span>
            <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">z</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">transplant</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">y</span><span class="p">.</span><span class="nx">Right</span><span class="p">)</span>
            <span class="nx">y</span><span class="p">.</span><span class="nx">Right</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Right</span>
            <span class="nx">y</span><span class="p">.</span><span class="nx">Right</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">y</span>
        <span class="p">}</span>
        <span class="nf">transplant</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">Left</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Left</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">Left</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">y</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">Color</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="nx">yOriginColor</span> <span class="o">==</span> <span class="nx">TreeNodeColorBlack</span> <span class="p">{</span>
        <span class="nf">deleteFixup</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// minimum 最小元素
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">minimum</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="o">*</span><span class="nx">TreeNode</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">t</span><span class="p">.</span><span class="nx">Left</span> <span class="o">==</span> <span class="nx">NilNode</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">t</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">minimum</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Left</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// transplant 结点交换
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">transplant</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">u</span><span class="p">,</span> <span class="nx">v</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">u</span><span class="p">.</span><span class="nx">Parent</span> <span class="o">==</span> <span class="nx">NilNode</span> <span class="p">{</span>
        <span class="nx">t</span> <span class="p">=</span> <span class="nx">v</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">u</span> <span class="o">==</span> <span class="nx">u</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span> <span class="p">{</span>
        <span class="nx">u</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span> <span class="p">=</span> <span class="nx">v</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">u</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Right</span> <span class="p">=</span> <span class="nx">v</span>
    <span class="p">}</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">=</span> <span class="nx">u</span><span class="p">.</span><span class="nx">Parent</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="删除中可能会发生的情况">删除中可能会发生的情况</h2>
<p>删除操作的重点是，删除结点z后的红黑树性质修复过程，在删除的过程中与<code>z执行交换的结点记为y</code>，<code>代替y位置的结点记为x</code>，如果y结点是红色的，那么当y被删除或移动时，红黑性质将会被保持，原因如下：</p>
<ul>
<li>树中的黑高没有变化。</li>
<li>不存在两个相邻的红色结点。因为y在树中占据了z的位置，再考虑到z的颜色，树中y的新位置不可能有两个相邻的红结点。另外，如果y不是z的右孩子，则y的原右孩子x代替y。如果y是红色的，则x肯定是黑色的，因此用x替换y不可能是两个红结点相邻。</li>
<li>如果y是红色的，就不可能是根结点，所以根结点依然是黑色的。</li>
</ul>
<p>如果y是黑色的，那么会产生三个问题，就需要修复：</p>
<ul>
<li>如果y是原来的根结点，而y的一个红色的孩子成为根结点，这就违反了性质2。</li>
<li>如果x和x.p是红色的，则违反了性质4。</li>
<li>在树中移动y将导致先前包含y的任何简单路径上黑结点数少1。因此，y的任何祖先都不满足性质5。改正这一问题的办法是将现在占有y原来位置的结点x视为还有一重额外的黑色，即在任意包含结点x的简单路径上黑结点个数加1。当将黑结点y删除或移动时，将其黑色“下推”给结点x，然后x会变为双重黑色或红黑色，这就分别给包含x的简单路径上的黑结点贡献了2或1。x的color属性仍是RED（红黑色）或BLACK（双重黑色），换言之，结点的额外黑色是针对x结点的，而不是反映在它的color属性上。</li>
</ul>
<h2 id="修复红黑树性质过程">修复红黑树性质过程</h2>
<h3 id="情况1x的兄弟结点w是红色的">情况1：x的兄弟结点w是红色的</h3>
<p><img src="/imgs/red_black_tree_delete_situation_1.png" alt="red_black_tree_delete_situation_1"></p>
<p>情况1发生在结点x的兄弟结点w为红色时，因为w的子节点必须为黑色，所以可以改变w和x.p的颜色，然后对x.p做一次左旋而不违反红黑树的任何性质，这样x的新兄弟结点是旋转之前w的某个子结点，其颜色为黑色，这样就将情况1装换为情况2、情况3或情况4处理。</p>
<h3 id="情况2x的兄弟结点w是黑色的且w的两个子节点都是黑色的">情况2：x的兄弟结点w是黑色的，且w的两个子节点都是黑色的</h3>
<p><img src="/imgs/red_black_tree_delete_situation_2.png" alt="red_black_tree_delete_situation_2"></p>
<p>情况2发生在，x的兄弟结点w是黑色的，且w的两个子节点都是黑色的。因为w也是黑色的，所以x和w上去掉一重黑色，在原来是红色或黑色的x.p上新增一重额外的黑色。通过将x.p作为新结点x来重复循环。如果通过情况1进入情况2，则新结点x是红黑色的，因为原来的x.p是红色的。因此新结点x的是红色的，并且会终止循环，然后再最后把新结点x着色为黑色。</p>
<h3 id="情况3x的兄弟结点w是黑色的w的左孩子是红色的w的右孩子是黑色的">情况3：x的兄弟结点w是黑色的，w的左孩子是红色的，w的右孩子是黑色的</h3>
<p><img src="/imgs/red_black_tree_delete_situation_3.png" alt="red_black_tree_delete_situation_3"></p>
<p>情况3发生在x的兄弟结点w是黑色的，w的左孩子为红色右孩子为黑色时，可以交换w和其左孩子的颜色，然后对w进行右旋。此时，x的新兄弟结点w是一个有红色右孩子的黑色结点，这样就转换为处理情况4。</p>
<h3 id="情况4x的兄弟结点w是黑色的且w的右孩子是红色的">情况4：x的兄弟结点w是黑色的，且w的右孩子是红色的</h3>
<p><img src="/imgs/red_black_tree_delete_situation_4.png" alt="red_black_tree_delete_situation_4"></p>
<p>情况4发生在x的兄弟结点w是黑色，且w的右孩子是红色时，通过颜色修改并对x.p做一次左旋，可以去掉x的额外颜色，从而使他变为单重黑色。将x设为根后，退出循环。</p>
<p>于是又以下代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// deleteFixup 删除修复
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">deleteFixup</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">x</span> <span class="o">*</span><span class="nx">TreeNode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">x</span> <span class="o">!=</span> <span class="nx">NilNode</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorBlack</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">x</span> <span class="o">==</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span> <span class="p">{</span>
            <span class="nx">w</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Right</span>
            <span class="k">if</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorRed</span> <span class="p">{</span>
                <span class="c1">// 情况1
</span><span class="c1"></span>                <span class="nx">w</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
                <span class="nf">LeftRotate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">)</span>
                <span class="nx">w</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Right</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Left</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorBlack</span> <span class="o">&amp;&amp;</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Right</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorBlack</span> <span class="p">{</span>
        <span class="c1">// 情况2
</span><span class="c1"></span>                <span class="nx">w</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
                <span class="nx">x</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Right</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorBlack</span> <span class="p">{</span>
        <span class="c1">// 情况3
</span><span class="c1"></span>                <span class="nx">w</span><span class="p">.</span><span class="nx">Left</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">w</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
                <span class="nf">RightRotate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">w</span><span class="p">)</span>
                <span class="nx">w</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Right</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// 情况4
</span><span class="c1"></span>                <span class="nx">w</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span>
                <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">w</span><span class="p">.</span><span class="nx">Right</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nf">LeftRotate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">)</span>
                <span class="nx">x</span> <span class="p">=</span> <span class="nx">t</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">w</span> <span class="o">:=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span>
            <span class="k">if</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorRed</span> <span class="p">{</span>
                <span class="nx">w</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
                <span class="nf">RightRotate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">)</span>
                <span class="nx">w</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Right</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorBlack</span> <span class="o">&amp;&amp;</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Left</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorBlack</span> <span class="p">{</span>
                <span class="nx">w</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
                <span class="nx">x</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Left</span><span class="p">.</span><span class="nx">Color</span> <span class="o">==</span> <span class="nx">TreeNodeColorBlack</span> <span class="p">{</span>
                <span class="nx">w</span><span class="p">.</span><span class="nx">Right</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">w</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorRed</span>
                <span class="nf">LeftRotate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">w</span><span class="p">)</span>
                <span class="nx">w</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Left</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">w</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span>
                <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nx">w</span><span class="p">.</span><span class="nx">Right</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
                <span class="nf">RightRotate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">Parent</span><span class="p">)</span>
                <span class="nx">x</span> <span class="p">=</span> <span class="nx">t</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">Color</span> <span class="p">=</span> <span class="nx">TreeNodeColorBlack</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>参考书目：《算法导论》</p>
</blockquote>

                        </div>

                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">数据结构</a></li>
                                
                                <li><a href="/tags/%E6%A0%91">树</a></li>
                                
                                <li><a href="/tags/%E7%BA%A2%E9%BB%91%E6%A0%91">红黑树</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
                    <div id="comments"><span class="widget-title">评论</span>
  <script src="https://utteranc.es/client.js"
          repo="peilanluo/comments"
          issue-term="url"
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script></div>

                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        
    
<form id="search" method="POST" action="https://duckduckgo.com/">
    
    <input type="text" name="q" maxlength="255" placeholder="搜索...">
    
    <input type="hidden" name="sites" value="https://peilanluo.github.io/">
    
    <input type="hidden" name="kp" value="-2">
    
    <input type="hidden" name="kh" value="1">
    
    <input type="hidden" name="kl" value="wt-wt">
    
    <input type="hidden" name="kg" value="p">
    
    <input type="hidden" name="kaf" value="1">
    
    
    <input type="hidden" name="k1" value="-1">

    

    
    
    <input type="hidden" name="k7" value="#ffffff">
    
    <input type="hidden" name="kj" value="#ffffff">
    
    <input type="hidden" name="ky" value="#eaeaea">
    
    <input type="hidden" name="kx" value="#6E7173">
    
    <input type="hidden" name="k8" value="#444">
    
    <input type="hidden" name="k9" value="#6E7173">
    
    <input type="hidden" name="kaa" value="#6E7173">
    
    <input type="hidden" name="kae" value="#6E7173">

    
    
    <input type="hidden" name="ko" value="1">
    
    <input type="hidden" name="kt" value="n">
    
    <input type="hidden" name="ka" value="g">
    
    <input type="hidden" name="ks" value="l">
    
    <input type="hidden" name="kv" value="1">

    <button type="submit" class="submit icon-search"></button>
</form>



    </section>

    <section class="widget">
        <h3 class="widget-title">分类</h3>
        <ul class="widget-list">
            
            <li>
                <a href="/categories/docker">
                    docker (2)
                </a>
            </li>
            
            <li>
                <a href="/categories/elasticsearch">
                    elasticsearch (1)
                </a>
            </li>
            
            <li>
                <a href="/categories/golang">
                    golang (5)
                </a>
            </li>
            
            <li>
                <a href="/categories/kubernetes">
                    kubernetes (4)
                </a>
            </li>
            
            <li>
                <a href="/categories/mongodb">
                    mongodb (3)
                </a>
            </li>
            
            <li>
                <a href="/categories/mysql">
                    mysql (7)
                </a>
            </li>
            
            <li>
                <a href="/categories/prometheus">
                    prometheus (2)
                </a>
            </li>
            
            <li>
                <a href="/categories/python">
                    python (3)
                </a>
            </li>
            
            <li>
                <a href="/categories/redis">
                    redis (4)
                </a>
            </li>
            
            <li>
                <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">
                    数据结构 (4)
                </a>
            </li>
            
        </ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-title">友情链接</h3>
        <ul class="widget-list">
            
            <li>
                <a rel="noreferrer noopener nofollow" href="http://www.pyhead.com" title="代码如诗，人生无限。">技术渣</a>
            </li>
            
        </ul>
    </section>
    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
      &copy; 2023 <a rel="nofollow" href="https://peilanluo.github.io/">默默的心路</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io">Hugo</a> &amp; <a rel="nofollow noreferer noopener" href="https://github.com/JokerQyou/maupassant-hugo">maupassant theme</a>.
    </div>
</footer>

<script type="text/javascript" src="/js/app.js" defer></script>

<script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' defer></script>


</body>
</html>
